<!DOCTYPE html>

<html>
<head>
  <title>Backbone React Component</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="backbone-react-component">Backbone React Component</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <pre><code>Backbone.React.Component v0<span class="hljs-number">.6</span><span class="hljs-number">.2</span>

(c) <span class="hljs-number">2014</span> <span class="hljs-string">"Magalhas"</span> José Magalhães &lt;magalhas@gmail.com&gt;
Backbone.React.Component can be freely distributed under the MIT license.
</code></pre><p><code>Backbone.React.Component</code> is a React.Component wrapper that serves
as a bridge between the React and Backbone worlds. Besides some extra members
that may be set by extending/instancing a component, it works pretty much the
same way that <a href="http://facebook.github.io/react/">React</a> components do.</p>
<p>When mounted (if using mixin mode) or created (wrapper mode) it starts listening
to models and collections changes to automatically set your component props and
achieve UI binding through reactive updates.</p>
<p>Basic usage</p>
<pre><code><span class="hljs-keyword">var</span> MyComponent = Backbone.React.Component.extend({
  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>{this.props.foo}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>;</span>
  }
});
<span class="hljs-keyword">var</span> model = <span class="hljs-keyword">new</span> Backbone.Model({foo: <span class="hljs-string">'bar'</span>});
<span class="hljs-keyword">var</span> myComponent = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">MyComponent</span> <span class="hljs-attribute">el</span>=<span class="hljs-value">{document.body}</span> <span class="hljs-attribute">model</span>=<span class="hljs-value">{model}</span> /&gt;</span>;</span>
myComponent.mount();
</code></pre><p>Mixin usage</p>
<pre><code><span class="hljs-keyword">var</span> MyComponent = React.createClass({
  mixins: [Backbone.React.Component.mixin],
  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>{this.props.foo}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>;</span>
  }
});
<span class="hljs-keyword">var</span> model = <span class="hljs-keyword">new</span> Backbone.Model({foo: <span class="hljs-string">'bar'</span>});
React.renderComponent(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">MyComponent</span> <span class="hljs-attribute">el</span>=<span class="hljs-value">{document.body}</span> <span class="hljs-attribute">model</span>=<span class="hljs-value">{model}</span> /&gt;</span>, document.body);</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">
'use strict'</span>;
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(root, factory)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Universal module definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd)
    define([<span class="hljs-string">'react'</span>, <span class="hljs-string">'backbone'</span>, <span class="hljs-string">'underscore'</span>], factory);
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> module !== <span class="hljs-string">'undefined'</span> &amp;&amp; module.exports) {
    <span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>);
    <span class="hljs-keyword">var</span> Backbone = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone'</span>);
    <span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
    module.exports = factory(React, Backbone, _);
  } <span class="hljs-keyword">else</span>
    factory(root.React, root.Backbone, root._);
}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(React, Backbone, _)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Here lies the public API available on each component that runs through the wrapper
instead of the mixin approach.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!Backbone.React) Backbone.React = {};
  Backbone.React.Component = {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Wraps <code>React.Component</code> into <code>Backbone.React.Component</code> and extends to a new
class.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    extend: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(Clazz)</span> {</span>
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Factory</span> <span class="hljs-params">(props, children)</span> {</span>
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Wrapper(Component, props, children)).virtualComponent;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Allow deep extending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Factory.extend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> Backbone.React.Component.extend(_.extend({}, Clazz, <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>]));
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Apply mixin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (Clazz.mixins) {
        <span class="hljs-keyword">if</span> (Clazz.mixins[<span class="hljs-number">0</span>] !== mixin)
          Clazz.mixins.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, mixin);
      } <span class="hljs-keyword">else</span>
        Clazz.mixins = [mixin];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Create the react component later used by <code>Factory</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> Component = React.createClass(_.extend(Factory.prototype, Clazz));
      <span class="hljs-keyword">return</span> Factory;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Renders/mounts the component. It delegates to <code>React.renderComponent</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, onRender)</span> {</span>
      <span class="hljs-keyword">if</span> (!(el || <span class="hljs-keyword">this</span>.el)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No element to mount on'</span>);
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!el) el = <span class="hljs-keyword">this</span>.el;
      <span class="hljs-keyword">this</span>.wrapper.component = React.renderComponent(<span class="hljs-keyword">this</span>, el, onRender);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Stops all listeners and unmounts this component from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.wrapper.component &amp;&amp; <span class="hljs-keyword">this</span>.wrapper.component.isMounted())
        <span class="hljs-keyword">this</span>.unmount();
      <span class="hljs-keyword">this</span>.wrapper.stopListening();
      <span class="hljs-keyword">this</span>.stopListening();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Intended to be used on the server side (Node.js), renders your component to a string
ready to be used on the client side by delegating to <code>React.renderComponentToString</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toHTML: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Since we’re only able to call <code>renderComponentToString</code> once, lets clone this component
and use it insteaad.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> clone = <span class="hljs-keyword">this</span>.clone(_.extend({}, <span class="hljs-keyword">this</span>.props, {
        collection: <span class="hljs-keyword">this</span>.wrapper.collection,
        model: <span class="hljs-keyword">this</span>.wrapper.model
      }));</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Return the html representation of the component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> React.renderComponentToString(clone);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Unmount the component from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unmount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> parentNode = <span class="hljs-keyword">this</span>.el.parentNode;
      <span class="hljs-keyword">if</span> (!React.unmountComponentAtNode(parentNode)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Throw an error if there’s any unmounting the component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'There was an error unmounting the component'</span>);
      }
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.wrapper.component;
      <span class="hljs-keyword">this</span>.setElement(parentNode);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Mixin used in all component instances. Exported through <code>Backbone.React.Component.mixin</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> mixin = Backbone.React.Component.mixin = {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Sets this.el and this.$el when the component mounts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    componentDidMount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">this</span>.setElement(<span class="hljs-keyword">this</span>.getDOMNode());
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Sets this.el and this.$el when the component updates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    componentDidUpdate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">this</span>.setElement(<span class="hljs-keyword">this</span>.getDOMNode());
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Checks if the component is running in mixin or wrapper mode when it mounts.
If it’s a mixin set a flag for later use and instance a Wrapper to take care
of models and collections binding.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    componentWillMount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.wrapper) {
        <span class="hljs-keyword">this</span>.isBackboneMixin = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.wrapper = <span class="hljs-keyword">new</span> Wrapper(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.props);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>If running in mixin mode disposes of the wrapper that was created when the
component mounted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    componentWillUnmount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.wrapper &amp;&amp; <span class="hljs-keyword">this</span>.isBackboneMixin) {
        <span class="hljs-keyword">this</span>.wrapper.stopListening();
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.wrapper;
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Shortcut to this.$el.find. Inspired by Backbone.View.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$el)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$el.find.apply(<span class="hljs-keyword">this</span>.$el, <span class="hljs-built_in">arguments</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Crawls to the owner of the component searching for a collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getCollection: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> owner = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> lookup = owner.wrapper;
      <span class="hljs-keyword">while</span> (!lookup.collection) {
        owner = owner._owner;
        <span class="hljs-keyword">if</span> (!owner) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Collection not found'</span>);
        lookup = owner.wrapper;
      }
      <span class="hljs-keyword">return</span> lookup.collection;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Crawls to the owner of the component searching for a model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getModel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> owner = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">var</span> lookup = owner.wrapper;
      <span class="hljs-keyword">while</span> (!lookup.model) {
        owner = owner._owner;
        <span class="hljs-keyword">if</span> (!owner) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Model not found'</span>);
        lookup = owner.wrapper;
      }
      <span class="hljs-keyword">return</span> lookup.model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Crawls <code>this._owner</code> recursively until it finds the owner of this
component. In case of being a parent component (no owners) it returns itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getOwner: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> owner = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">while</span> (owner._owner) owner = owner._owner;
      <span class="hljs-keyword">return</span> owner;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Sets a DOM element to render/mount this component on this.el and this.$el.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setElement: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el)</span> {</span>
      <span class="hljs-keyword">if</span> (el &amp;&amp; Backbone.$ &amp;&amp; el <span class="hljs-keyword">instanceof</span> Backbone.$) {
        <span class="hljs-keyword">if</span> (el.length &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'You can only assign one element to a component'</span>);
        <span class="hljs-keyword">this</span>.el = el[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">this</span>.$el = el;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (el) {
        <span class="hljs-keyword">this</span>.el = el;
        <span class="hljs-keyword">if</span> (Backbone.$) <span class="hljs-keyword">this</span>.$el = Backbone.$(el);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Binds models and collections to a React.Component. It mixes Backbone.Events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Wrapper</span> <span class="hljs-params">(Component, props)</span> {</span>
    props = props || {};
    <span class="hljs-keyword">var</span> el, model = props.model, collection = props.collection;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Check if props.el is a DOM element or a jQuery object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (_.isElement(props.el) || Backbone.$ &amp;&amp; props.el <span class="hljs-keyword">instanceof</span> Backbone.$) {
      el = props.el;
      <span class="hljs-keyword">delete</span> props.el;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Check if props.model is a Backbone.Model or an hashmap of them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> model !== <span class="hljs-string">'undefined'</span> &amp;&amp; (model.attributes ||
        <span class="hljs-keyword">typeof</span> model === <span class="hljs-string">'object'</span> &amp;&amp; _.values(model)[<span class="hljs-number">0</span>].attributes)) {
      <span class="hljs-keyword">delete</span> props.model;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>The model(s) bound to this component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.model = model;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Set model(s) attributes on props for the first render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.setPropsBackbone(model, <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, props);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Check if props.collection is a Backbone.Collection or an hashmap of them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> collection !== <span class="hljs-string">'undefined'</span> &amp;&amp; (collection.models ||
        <span class="hljs-keyword">typeof</span> collection === <span class="hljs-string">'object'</span> &amp;&amp; _.values(collection)[<span class="hljs-number">0</span>].models)) {
      <span class="hljs-keyword">delete</span> props.collection;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>The collection(s) bound to this component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.collection = collection;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Set collection(s) models on props for the first render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.setPropsBackbone(collection, <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, props);
    }
    <span class="hljs-keyword">var</span> component;
    <span class="hljs-keyword">if</span> (Component.prototype) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Instance the component mixing Backbone.Events, our public API and some special
properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      component = <span class="hljs-keyword">this</span>.virtualComponent = _.defaults(Component.apply(<span class="hljs-keyword">this</span>, _.rest(<span class="hljs-built_in">arguments</span>)).__realComponentInstance,
          Backbone.Events, _.omit(Backbone.React.Component, <span class="hljs-string">'mixin'</span>), {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Clones the component wrapper and returns the component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        clone: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(props, children)</span> {</span>
          <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Wrapper(Component, props, children)).virtualComponent;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Assign a component unique id, this is handy sometimes as a DOM attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cid: _.uniqueId(),</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>One to one relationship between the wrapper and the component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        wrapper: <span class="hljs-keyword">this</span>
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Set element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (el) mixin.setElement.call(component, el);
    } <span class="hljs-keyword">else</span> {
      component = Component;
      <span class="hljs-keyword">this</span>.component = component;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Start listeners if this is a root node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!component._owner) {
      <span class="hljs-keyword">this</span>.startModelListeners();
      <span class="hljs-keyword">this</span>.startCollectionListeners();
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Mixing <code>Backbone.Events</code> into <code>Wrapper.prototype</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(Wrapper.prototype, Backbone.Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Sets this.props when a model/collection request results in error. It delegates
to <code>this.setProps</code>. It listens to <code>Backbone.Model#error</code> and <code>Backbone.Collection#error</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onError: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelOrCollection, res, options)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Set props only if there’s no silent option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!options.silent)
        <span class="hljs-keyword">this</span>.setProps({
          isRequesting: <span class="hljs-literal">false</span>,
          hasError: <span class="hljs-literal">true</span>,
          error: res
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Sets this.props when a model/collection request starts. It delegates to
<code>this.setProps</code>. It listens to <code>Backbone.Model#request</code> and <code>Backbone.Collection#request</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onRequest: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelOrCollection, xhr, options)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Set props only if there’s no silent option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!options.silent)
        <span class="hljs-keyword">this</span>.setProps({
          isRequesting: <span class="hljs-literal">true</span>,
          hasError: <span class="hljs-literal">false</span>
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Sets this.props when a model/collection syncs. It delegates to <code>this.setProps</code>.
It listens to <code>Backbone.Model#sync</code> and <code>Backbone.Collection#sync</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onSync: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelOrCollection, res, options)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Set props only if there’s no silent option</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!options.silent)
        <span class="hljs-keyword">this</span>.setProps({isRequesting: <span class="hljs-literal">false</span>});
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Used internally to set this.collection or this.model on this.props. Delegates to
<code>this.setProps</code>. It listens to <code>Backbone.Collection#add</code>, <code>Backbone.Collection#remove</code>,
<code>Backbone.Collection#change</code> and <code>Backbone.Model#change</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setPropsBackbone: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelOrCollection, key, target)</span> {</span>
      <span class="hljs-keyword">if</span> (!(modelOrCollection.models || modelOrCollection.attributes)) {
        <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> modelOrCollection)
            <span class="hljs-keyword">this</span>.setPropsBackbone(modelOrCollection[key], key, target);
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">this</span>.setProps.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Sets a model, collection or object into props by delegating to <code>React.Component#setProps</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setProps: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(modelOrCollection, key, target)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>If the component isn’t rendered/mounted set target because you can’t set props
on an unmounted (virtual) component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!target &amp;&amp; !(<span class="hljs-keyword">this</span>.component &amp;&amp; <span class="hljs-keyword">this</span>.component.isMounted()))
        target = <span class="hljs-keyword">this</span>.virtualComponent.props;
      <span class="hljs-keyword">var</span> props = {};
      <span class="hljs-keyword">var</span> newProps = modelOrCollection.toJSON ? modelOrCollection.toJSON() : modelOrCollection;

      <span class="hljs-keyword">if</span> (key)
        props[key] = newProps;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modelOrCollection <span class="hljs-keyword">instanceof</span> Backbone.Collection)
        props.collection = newProps;
      <span class="hljs-keyword">else</span>
        props = newProps;

      <span class="hljs-keyword">if</span> (target) _.extend(target, props);
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.nextProps = _.extend(<span class="hljs-keyword">this</span>.nextProps || {}, props);
        _.defer(_.bind(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.nextProps) {
            <span class="hljs-keyword">this</span>.component.setProps(<span class="hljs-keyword">this</span>.nextProps);
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.nextProps;
          }
        }, <span class="hljs-keyword">this</span>));
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Binds the component to any collection changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    startCollectionListeners: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(collection, key)</span> {</span>
      <span class="hljs-keyword">if</span> (!collection) collection = <span class="hljs-keyword">this</span>.collection;
      <span class="hljs-keyword">if</span> (collection) {
        <span class="hljs-keyword">if</span> (collection.models)
          <span class="hljs-keyword">this</span>
            .listenTo(collection, <span class="hljs-string">'add remove change sort reset'</span>,
              _.partial(<span class="hljs-keyword">this</span>.setPropsBackbone, collection, key, <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>))
            .listenTo(collection, <span class="hljs-string">'error'</span>, <span class="hljs-keyword">this</span>.onError)
            .listenTo(collection, <span class="hljs-string">'request'</span>, <span class="hljs-keyword">this</span>.onRequest)
            .listenTo(collection, <span class="hljs-string">'sync'</span>, <span class="hljs-keyword">this</span>.onSync);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> collection === <span class="hljs-string">'object'</span>)
          <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> collection)
            <span class="hljs-keyword">if</span> (collection.hasOwnProperty(key))
              <span class="hljs-keyword">this</span>.startCollectionListeners(collection[key], key);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Binds the component to any model changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    startModelListeners: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model, key)</span> {</span>
      <span class="hljs-keyword">if</span> (!model) model = <span class="hljs-keyword">this</span>.model;
      <span class="hljs-keyword">if</span> (model) {
        <span class="hljs-keyword">if</span> (model.attributes)
          <span class="hljs-keyword">this</span>
            .listenTo(model, <span class="hljs-string">'change'</span>,
              _.partial(<span class="hljs-keyword">this</span>.setPropsBackbone, model, key, <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>))
            .listenTo(model, <span class="hljs-string">'error'</span>, <span class="hljs-keyword">this</span>.onError)
            .listenTo(model, <span class="hljs-string">'request'</span>, <span class="hljs-keyword">this</span>.onRequest)
            .listenTo(model, <span class="hljs-string">'sync'</span>, <span class="hljs-keyword">this</span>.onSync);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> model === <span class="hljs-string">'object'</span>)
          <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> model)
            <span class="hljs-keyword">this</span>.startModelListeners(model[key], key);
      }
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Expose <code>Backbone.React.Component</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> Backbone.React.Component;
}));</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><a href="https://github.com/magalhas/backbone-react-component"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a></p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
